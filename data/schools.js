// 台灣大專院校與研究機構地點對照表
const schoolLocations = {
    // 研究機構
    "中央研究院": "臺北市", "中研院": "臺北市",
    "國家衛生研究院": "苗栗縣", "國衛院": "苗栗縣",
    "工研院": "新竹縣",
    "國家實驗研究院": "臺北市", "國研院": "臺北市",

    // 北部
    "國立臺灣大學": "臺北市", "國立台灣大學": "臺北市", "台大": "臺北市",
    "國立政治大學": "臺北市", "政大": "臺北市",
    "國立臺灣師範大學": "臺北市", "臺師大": "臺北市", "台師大": "臺北市",
    "國立臺北大學": "新北市", "臺北大學": "新北市", "北大": "新北市",
    "國立臺北教育大學": "臺北市", "國北教": "臺北市",
    "國立臺北藝術大學": "臺北市", "北藝大": "臺北市",
    "國立臺灣藝術大學": "新北市", "臺藝大": "新北市",
    "國立臺灣科技大學": "臺北市", "臺科大": "臺北市",
    "國立臺北科技大學": "臺北市", "北科大": "臺北市",
    "國立臺灣海洋大學": "基隆市", "海大": "基隆市",
    "國立中央大學": "桃園市", "中央大學": "桃園市",
    "國立體育大學": "桃園市", "國體大": "桃園市",
    "國立陽明交通大學": "臺北市", "陽明交大": "臺北市", // 雙校區，以台北為主或視情況
    "國立清華大學": "新竹市", "清大": "新竹市",
    "輔仁大學": "新北市",
    "東吳大學": "臺北市",
    "淡江大學": "新北市",
    "銘傳大學": "臺北市",
    "實踐大學": "臺北市",
    "世新大學": "臺北市",
    "文化大學": "臺北市",
    "大同大學": "臺北市",
    "中原大學": "桃園市",
    "長庚大學": "桃園市",
    "元智大學": "桃園市",
    "開南大學": "桃園市",
    "中華大學": "新竹市",
    "玄奘大學": "新竹市",
    "龍華科技大學": "桃園市",
    "明志科技大學": "新北市",
    "聖約翰科技大學": "新北市",
    "中國科技大學": "臺北市",
    "德明財經科技大學": "臺北市",
    "致理科技大學": "新北市",
    "景文科技大學": "新北市",
    "東南科技大學": "新北市",
    "台北醫學大學": "臺北市", "臺北醫學大學": "臺北市", "北醫": "臺北市",
    "馬偕醫學院": "新北市",
    "國立臺北商業大學": "臺北市", "北商大": "臺北市",
    "國立臺北護理健康大學": "臺北市", "國北護": "臺北市",

    // 中部
    "國立中興大學": "臺中市", "中興大學": "臺中市",
    "國立臺中教育大學": "臺中市", "中教大": "臺中市",
    "國立彰化師範大學": "彰化縣", "彰師大": "彰化縣",
    "國立暨南國際大學": "南投縣", "暨南大學": "南投縣",
    "國立雲林科技大學": "雲林縣", "雲科大": "雲林縣",
    "國立虎尾科技大學": "雲林縣", "虎尾科大": "雲林縣",
    "國立勤益科技大學": "臺中市", "勤益科大": "臺中市",
    "國立臺中科技大學": "臺中市", "中科大": "臺中市",
    "東海大學": "臺中市",
    "逢甲大學": "臺中市",
    "靜宜大學": "臺中市",
    "大葉大學": "彰化縣",
    "明道大學": "彰化縣",
    "南開科技大學": "南投縣",
    "建國科技大學": "彰化縣",
    "中臺科技大學": "臺中市",
    "朝陽科技大學": "臺中市",
    "弘光科技大學": "臺中市",
    "嶺東科技大學": "臺中市",
    "僑光科技大學": "臺中市",
    "亞洲大學": "臺中市",
    "中國醫藥大學": "臺中市", "中國醫": "臺中市",
    "中山醫學大學": "臺中市", "中山醫": "臺中市",
    "國立聯合大學": "苗栗縣", "聯合大學": "苗栗縣",

    // 南部
    "國立成功大學": "臺南市", "成大": "臺南市",
    "國立中山大學": "高雄市", "中山大學": "高雄市",
    "國立中正大學": "嘉義縣", "中正大學": "嘉義縣",
    "國立高雄師範大學": "高雄市", "高師大": "高雄市",
    "國立彰化師範大學": "彰化縣", 
    "國立嘉義大學": "嘉義市", "嘉義大學": "嘉義市",
    "國立臺南大學": "臺南市", "臺南大學": "臺南市",
    "國立臺南藝術大學": "臺南市", "南藝大": "臺南市",
    "國立高雄大學": "高雄市", "高雄大學": "高雄市",
    "國立屏東大學": "屏東縣", "屏東大學": "屏東縣",
    "國立高雄科技大學": "高雄市", "高科大": "高雄市",
    "國立屏東科技大學": "屏東縣", "屏科大": "屏東縣",
    "義守大學": "高雄市",
    "長榮大學": "臺南市",
    "南華大學": "嘉義縣",
    "康寧大學": "臺南市",
    "南臺科技大學": "臺南市",
    "崑山科技大學": "臺南市",
    "嘉南藥理大學": "臺南市",
    "台南應用科技大學": "臺南市",
    "遠東科技大學": "臺南市",
    "中華醫事科技大學": "臺南市",
    "樹德科技大學": "高雄市",
    "輔英科技大學": "高雄市",
    "正修科技大學": "高雄市",
    "高苑科技大學": "高雄市",
    "文藻外語大學": "高雄市",
    "高雄醫學大學": "高雄市", "高醫": "高雄市",

    // 東部
    "國立東華大學": "花蓮縣", "東華大學": "花蓮縣",
    "國立宜蘭大學": "宜蘭縣", "宜蘭大學": "宜蘭縣",
    "國立臺東大學": "臺東縣", "臺東大學": "臺東縣",
    "慈濟大學": "花蓮縣",
    "佛光大學": "宜蘭縣",

    // 離島
    "國立金門大學": "金門縣", "金門大學": "金門縣",
    "國立澎湖科技大學": "澎湖縣", "澎科大": "澎湖縣"
};

/**
 * 根據學校名稱推論地點
 * @param {string} schoolName 學校名稱
 * @returns {string} 縣市名稱 (例如 "臺北市") 或空字串
 */
function inferLocation(schoolName) {
    if (!schoolName) return '';
    
    // 1. 精確比對 (優先)
    for (const [key, loc] of Object.entries(schoolLocations)) {
        if (schoolName.includes(key)) {
            return loc;
        }
    }

    // 2. 模糊比對 (從校名中猜測縣市)
    const cities = ['臺北', '台北', '新北', '桃園', '新竹', '苗栗', '臺中', '台中', '彰化', '雲林', '嘉義', '臺南', '台南', '高雄', '屏東', '宜蘭', '花蓮', '臺東', '台東', '澎湖', '基隆', '金門', '南投'];
    
    for (const city of cities) {
        if (schoolName.includes(city)) {
            // 正規化縣市名稱
            let normalized = city.replace('台', '臺');
            // 判斷是市還是縣 (簡單邏輯)
            if (['臺北', '新北', '新竹', '臺中', '嘉義', '臺南', '高雄', '基隆'].includes(normalized)) {
                // 新竹與嘉義有分縣市，這裡簡單處理，若校名沒寫縣就當市
                if ((normalized === '新竹' || normalized === '嘉義') && schoolName.includes('縣')) {
                    return normalized + '縣';
                }
                return normalized + '市';
            }
            return normalized + '縣'; 
        }
    }
    
    return '';
}

// 為了讓前端 (瀏覽器) 和後端 (Node.js) 都能用，做個簡單的環境判斷
if (typeof module !== 'undefined' && module.exports) {
    module.exports = { inferLocation };
} else {
    // 瀏覽器環境：掛在 window 上
    window.SchoolData = { inferLocation };
}